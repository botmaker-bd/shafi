# render.yaml - OPTIMIZED FOR RENDER.COM
services:
  - type: web
    name: telegram-bot-platform
    env: node
    plan: free
    buildCommand: |
      # 1. Node.js dependencies
      echo "ðŸ“¦ Installing Node.js dependencies..."
      npm install
      
      # 2. Check Python availability
      echo "ðŸ Checking Python environment..."
      if command -v python3 > /dev/null 2>&1; then
          echo "âœ… Python3 found: $(python3 --version)"
      else
          echo "âš ï¸ Python3 not found, trying to install..."
          apt-get update && apt-get install -y python3 python3-pip 2>/dev/null || echo "Python installation skipped"
      fi
      
      # 3. Install Python requirements with --break-system-packages
      echo "ðŸ“¦ Installing Python packages..."
      if [ -f "requirements.txt" ]; then
          echo "Found requirements.txt, installing packages..."
          
          # Try multiple installation methods
          if command -v pip3 > /dev/null 2>&1; then
              pip3 install --upgrade pip 2>/dev/null || true
              pip3 install -r requirements.txt --break-system-packages --no-warn-script-location 2>/dev/null || \
              echo "âš ï¸ pip3 installation had issues"
          elif command -v pip > /dev/null 2>&1; then
              pip install --upgrade pip 2>/dev/null || true
              pip install -r requirements.txt --break-system-packages --no-warn-script-location 2>/dev/null || \
              echo "âš ï¸ pip installation had issues"
          else
              echo "âŒ Pip not found, trying python -m pip..."
              python3 -m pip install --upgrade pip 2>/dev/null || true
              python3 -m pip install -r requirements.txt --break-system-packages --no-warn-script-location 2>/dev/null || \
              echo "âš ï¸ python -m pip installation had issues"
          fi
          
          echo "âœ… Python packages installation attempted"
      else
          echo "âš ï¸ requirements.txt not found, creating default..."
          echo "requests==2.31.0" > requirements.txt
          echo "beautifulsoup4==4.12.2" >> requirements.txt
          echo "python-dotenv==1.0.0" >> requirements.txt
          echo "aiohttp==3.8.5" >> requirements.txt
          
          # Install basic packages
          pip3 install requests beautifulsoup4 python-dotenv aiohttp --break-system-packages --no-warn-script-location 2>/dev/null || \
          echo "âš ï¸ Basic package installation had issues"
      fi
      
      # 4. Make scripts executable
      echo "ðŸ”§ Setting up scripts..."
      chmod +x scripts/*.sh 2>/dev/null || true
      
      echo "ðŸš€ Build completed successfully!"
    startCommand: npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: USE_WEBHOOK
        value: true
      - key: BASE_URL
        value: https://bot-maker-bd.onrender.com
      - key: SUPABASE_URL
        value: https://tyoaazgsoqvubgfychmd.supabase.co
      - key: SUPABASE_KEY
        generateValue: true
      - key: PYTHONUNBUFFERED
        value: 1
    healthCheckPath: /api/health
    autoDeploy: true