<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bot Maker â€” Commands</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; margin: 0; padding: 0; background: #0f172a; color: #e2e8f0; }
    header { padding: 20px; background: #111827; box-shadow: 0 2px 10px rgba(0,0,0,0.3); position: sticky; top: 0; z-index: 10; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    .card { background: #111827; border: 1px solid #1f2937; border-radius: 16px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    input, textarea { width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid #334155; background: #0b1220; color: #e2e8f0; }
    button { padding: 10px 16px; border-radius: 10px; border: 1px solid #334155; background: #0b1220; color: #e2e8f0; cursor: pointer; }
    button:hover { transform: translateY(-1px); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .list { margin-top: 16px; }
    .item { display: flex; align-items: center; justify-content: space-between; border: 1px solid #1f2937; background: #0b1220; padding: 12px; border-radius: 12px; margin-top: 10px; }
    .muted { color: #94a3b8; font-size: 12px; }
    .badge { background: #1f2937; padding: 4px 8px; border-radius: 999px; font-size: 12px; border: 1px solid #334155; }
    .hint { margin-top: 10px; }
    .right { display: flex; gap: 8px; }
    .token { width: 380px; max-width: 100%; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h2 style="margin:0">ðŸ¤– Bot Maker â€” Command Manager</h2>
      <div class="muted">Add commands like <span class="badge">/hello</span> â†’ reply text. Your bot will answer via Telegram webhook.</div>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <div class="row">
        <div>
          <label>Command (without slash)</label>
          <input id="cmd" placeholder="hello, start, help" />
        </div>
        <div>
          <label>Reply</label>
          <input id="reply" placeholder="Hi there! ðŸ‘‹" />
        </div>
      </div>
      <div class="hint muted">Optional admin token (if configured):</div>
      <input id="adminToken" class="token" placeholder="x-admin-token value (if set)" />
      <div style="margin-top:12px">
        <button id="save">Save / Update</button>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <h3 style="margin:0">Saved Commands</h3>
        <button id="refresh">Refresh</button>
      </div>
      <div id="list" class="list"></div>
    </div>

    <div class="card" style="margin-top:16px">
      <h3 style="margin-top:0">Webhook Setup</h3>
      <p class="muted">Set Telegram webhook to<br>
      <code id="webhookExample">/webhook/&lt;WEBHOOK_SECRET&gt;</code>
      </p>
      <p class="muted">Example request:<br>
      <code>https://api.telegram.org/bot&lt;BOT_TOKEN&gt;/setWebhook?url=https://YOUR_DOMAIN/webhook/&lt;WEBHOOK_SECRET&gt;</code></p>
    </div>
  </div>

  <script>
    const listEl = document.getElementById('list');
    const adminTokenEl = document.getElementById('adminToken');

    function headers() {
      const h = { 'Content-Type': 'application/json' };
      const t = adminTokenEl.value.trim();
      if (t) h['x-admin-token'] = t;
      return h;
    }

    async function fetchList() {
      listEl.innerHTML = '<div class="muted">Loading...</div>';
      try {
        const res = await fetch('/api/commands', { headers: headers() });
        if (!res.ok) throw new Error('Failed to load');
        const data = await res.json();
        if (data.length === 0) {
          listEl.innerHTML = '<div class="muted">No commands yet.</div>';
          return;
        }
        listEl.innerHTML = '';
        data.forEach(row => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <div>
              <div><span class="badge">/${row.command}</span></div>
              <div class="muted">${row.reply}</div>
            </div>
            <div class="right">
              <button data-id="${row.id}" class="del">Delete</button>
            </div>
          `;
          listEl.appendChild(div);
        });
        document.querySelectorAll('.del').forEach(btn => {
          btn.addEventListener('click', async () => {
            const id = btn.getAttribute('data-id');
            if (!confirm('Delete this command?')) return;
            const res = await fetch('/api/commands/' + id, { method: 'DELETE', headers: headers() });
            if (res.ok) fetchList();
            else alert('Delete failed');
          });
        });
      } catch (e) {
        listEl.innerHTML = '<div class="muted">Failed to load commands. Check Admin Token or server.</div>';
      }
    }

    document.getElementById('save').addEventListener('click', async () => {
      const cmd = document.getElementById('cmd').value.trim();
      const rep = document.getElementById('reply').value.trim();
      if (!cmd || !rep) return alert('Command and reply are required');
      const res = await fetch('/api/commands', {
        method: 'PUT',
        headers: headers(),
        body: JSON.stringify({ command: cmd, reply: rep })
      });
      if (res.ok) {
        document.getElementById('cmd').value = '';
        document.getElementById('reply').value = '';
        fetchList();
      } else {
        const t = await res.text();
        alert('Save failed: ' + t);
      }
    });

    document.getElementById('refresh').addEventListener('click', fetchList);
    fetchList();
  </script>
</body>
</html>